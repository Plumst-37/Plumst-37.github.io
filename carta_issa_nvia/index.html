<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Carta Sellada con Amor</title>
  <style>
    /* =========================================================
       RESET + VARIABLES
    ========================================================= */
    :root {
      --ease: cubic-bezier(0.65, 0, 0.35, 1);
      --ease-out: cubic-bezier(0.22, 0.61, 0.36, 1);
      --ease-in-out: cubic-bezier(0.87, 0, 0.13, 1);
      
      --bg-dark: #0a0e14;
      --bg-wood-1: #1a120d;
      --bg-wood-2: #2a1b12;
      --bg-wood-3: #3a2418;
      
      --envelope-color-1: #f8f0e1;
      --envelope-color-2: #f0e2c9;
      --envelope-color-3: #e8d4b1;
      
      --paper-color-1: #fffef9;
      --paper-color-2: #fdf8f0;
      --paper-color-3: #fbf2e7;
      
      --wax-red-1: #c53030;
      --wax-red-2: #a82525;
      --wax-red-3: #8a1c1c;
      
      --ink-color: #2c1810;
      --shadow-heavy: rgba(0, 0, 0, 0.45);
      --shadow-medium: rgba(0, 0, 0, 0.3);
      --shadow-light: rgba(0, 0, 0, 0.15);
      
      /* Variables responsivas - se ajustan en media queries */
      --envelope-width: min(480px, 90vw);
      --envelope-height: calc(var(--envelope-width) * 0.6);
      --paper-width: calc(var(--envelope-width) * 0.85);
      --paper-height: min(580px, 70vh);
      --paper-top: -180px; /* Posici贸n de la carta cuando est谩 abierta */
      
      --border-radius: 12px;
      --photo-height: clamp(140px, 20vh, 200px);
      
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
      touch-action: manipulation;
    }
    
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      background: 
        radial-gradient(circle at 15% 25%, rgba(139, 92, 66, 0.2), transparent 45%),
        radial-gradient(circle at 85% 75%, rgba(190, 130, 90, 0.15), transparent 45%),
        linear-gradient(135deg, var(--bg-dark), #121822);
      color: #fff;
      position: relative;
      perspective: 1000px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    /* Textura sutil de grano */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background-image: 
        repeating-linear-gradient(0deg, rgba(255,255,255,0.03) 0px, rgba(255,255,255,0.03) 1px, transparent 1px, transparent 3px),
        repeating-linear-gradient(90deg, rgba(255,255,255,0.03) 0px, rgba(255,255,255,0.03) 1px, transparent 1px, transparent 3px);
      opacity: 0.3;
      pointer-events: none;
      z-index: 0;
      animation: grain 8s steps(10) infinite;
    }
    
    @keyframes grain {
      0%, 100% { transform: translate(0, 0); }
      10% { transform: translate(-1%, -1%); }
      20% { transform: translate(1%, 2%); }
      30% { transform: translate(-2%, -1%); }
      40% { transform: translate(2%, 1%); }
      50% { transform: translate(-1%, 2%); }
      60% { transform: translate(1%, -1%); }
      70% { transform: translate(-2%, 2%); }
      80% { transform: translate(2%, -2%); }
      90% { transform: translate(-1%, 1%); }
    }
    
    /* =========================================================
       MESA / BODEGN
    ========================================================= */
    .desk {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 50vh;
      background: 
        linear-gradient(to top, var(--bg-wood-1), var(--bg-wood-2) 30%, var(--bg-wood-3)),
        repeating-linear-gradient(90deg, 
          transparent, 
          transparent 25px, 
          rgba(0, 0, 0, 0.04) 25px, 
          rgba(0, 0, 0, 0.04) 26px
        );
      border-top: 2px solid rgba(60, 40, 25, 0.8);
      box-shadow: 
        0 -15px 40px rgba(0, 0, 0, 0.6),
        inset 0 15px 30px rgba(255, 255, 255, 0.05);
      z-index: 1;
      transform: perspective(1200px) rotateX(20deg);
      transform-origin: bottom;
    }
    
    /* Efecto de vetas de madera */
    .desk::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100%;
      background: 
        linear-gradient(90deg, transparent 60%, rgba(100, 60, 30, 0.15) 100%),
        radial-gradient(ellipse at 30% 80%, rgba(150, 100, 50, 0.25), transparent 70%);
      pointer-events: none;
    }
    
    /* Luz c谩lida sobre la mesa */
    .desk-light {
      position: fixed;
      bottom: 30%;
      left: 50%;
      width: min(800px, 120%);
      height: 300px;
      transform: translateX(-50%);
      background: radial-gradient(ellipse at center, rgba(255, 220, 180, 0.2) 0%, transparent 70%);
      filter: blur(30px);
      opacity: 0;
      transition: opacity 1s var(--ease);
      z-index: 2;
      pointer-events: none;
    }
    
    /* =========================================================
       CONTENEDOR PRINCIPAL - CENTRADO Y RESPONSIVE
    ========================================================= */
    .container {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 900px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      padding-bottom: 100px; /* Espacio extra para m贸viles */
    }
    
    /* =========================================================
       SOBRE (CON PERSPECTIVA Y Z-INDEX BAJO)
    ========================================================= */
    .envelope-wrapper {
      position: relative;
      width: var(--envelope-width);
      height: var(--envelope-height);
      margin-bottom: 30px;
      cursor: pointer;
      z-index: 20; /* IMPORTANTE: m谩s bajo que la carta cuando est谩 abierta */
      filter: drop-shadow(0 10px 30px var(--shadow-heavy));
      transition: transform 0.5s var(--ease), z-index 0.01s linear 0.5s;
      margin-top: 20px;
    }
    
    .envelope-wrapper:hover {
      transform: translateY(-5px) scale(1.02);
    }
    
    .envelope {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(160deg, var(--envelope-color-1), var(--envelope-color-2));
      border-radius: var(--border-radius);
      overflow: hidden;
      border: 1px solid rgba(120, 90, 60, 0.3);
      box-shadow: 
        inset 0 0 20px rgba(255, 255, 255, 0.3),
        inset 0 0 0 1px rgba(255, 255, 255, 0.2),
        0 5px 15px var(--shadow-medium);
    }
    
    /* Textura de papel envejecido */
    .envelope::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(180, 140, 100, 0.12) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(160, 120, 80, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(140, 100, 60, 0.08) 0%, transparent 50%);
      border-radius: var(--border-radius);
      pointer-events: none;
    }
    
    /* Tapa del sobre */
    .envelope-flap {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 70%;
      background: linear-gradient(160deg, var(--envelope-color-2), var(--envelope-color-3));
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      transform-origin: top center;
      transform: rotateX(0deg);
      transition: transform 1.2s var(--ease-out) 0.2s;
      z-index: 25;
      box-shadow: 
        0 -3px 10px var(--shadow-light),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
      clip-path: polygon(0% 0%, 100% 0%, 50% 100%);
    }
    
    /* Laterales del sobre */
    .envelope-side {
      position: absolute;
      width: 50%;
      height: 100%;
      background: linear-gradient(160deg, var(--envelope-color-2), var(--envelope-color-1));
      border-radius: var(--border-radius);
    }
    
    .envelope-side.left {
      left: 0;
      clip-path: polygon(0% 0%, 100% 20%, 100% 100%, 0% 100%);
    }
    
    .envelope-side.right {
      right: 0;
      clip-path: polygon(0% 20%, 100% 0%, 100% 100%, 0% 100%);
    }
    
    /* Parte inferior del sobre */
    .envelope-bottom {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 40%;
      background: linear-gradient(to top, var(--envelope-color-3), var(--envelope-color-2));
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      clip-path: polygon(0% 100%, 50% 0%, 100% 100%);
    }
    
    /* =========================================================
       SELLO DE CERA (CORREGIDO CON CORAZN)
    ========================================================= */
    .wax-seal {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 70px;
      height: 70px;
      transform: translate(-50%, -50%);
      background: 
        radial-gradient(circle at 30% 30%, var(--wax-red-1), var(--wax-red-2) 50%, var(--wax-red-3)),
        conic-gradient(
          from 45deg,
          rgba(255, 255, 255, 0.1) 0deg 90deg,
          rgba(0, 0, 0, 0.05) 90deg 180deg,
          rgba(255, 255, 255, 0.08) 180deg 270deg,
          rgba(0, 0, 0, 0.03) 270deg 360deg
        );
      border-radius: 50%;
      z-index: 30;
      box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.4),
        inset 0 3px 8px rgba(255, 255, 255, 0.25),
        inset 0 -3px 8px rgba(0, 0, 0, 0.4);
      transition: all 1s var(--ease);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    
    /* Textura de cera rugosa */
    .wax-seal::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.15), transparent 70%),
        repeating-radial-gradient(circle at 50% 50%, 
          transparent, 
          transparent 3px, 
          rgba(0, 0, 0, 0.05) 3px, 
          rgba(0, 0, 0, 0.05) 4px
        );
      border-radius: 50%;
      filter: blur(0.5px);
    }
    
    /* Coraz贸n del sello - SVG inline */
    .wax-seal::after {
      content: '';
      position: absolute;
      width: 32px;
      height: 28px;
      background: rgba(255, 255, 255, 0.9);
      clip-path: path('M16 4.652c0 4.5-5.6 8.348-7.2 10.348-1.6-2-7.2-5.848-7.2-10.348 0-2.5 2-4.5 4.5-4.5 1.5 0 3 1 3.5 2.5.5-1.5 2-2.5 3.5-2.5 2.5 0 4.5 2 4.5 4.5z');
      filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.3));
      z-index: 2;
    }
    
    /* Borde del sello con relieve */
    .seal-border {
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      border-radius: 50%;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(0, 0, 0, 0.15));
      z-index: -1;
      filter: blur(2px);
    }
    
    /* Cuerda del sobre */
    .envelope-string {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 100%;
      transform: translate(-50%, -50%);
      background: linear-gradient(to bottom, 
        transparent 10%, 
        rgba(90, 60, 30, 0.8) 10% 15%,
        rgba(120, 90, 50, 0.9) 15% 85%,
        rgba(90, 60, 30, 0.8) 85% 90%,
        transparent 90%
      );
      z-index: 22;
      border-radius: 2.5px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
    }
    
    /* =========================================================
       CARTA - POSICIN CENTRAL MEJORADA
    ========================================================= */
    .letter-container {
      position: absolute;
      width: var(--paper-width);
      height: var(--paper-height);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9) translateY(100px);
      z-index: 15;
      opacity: 0;
      transition: 
        transform 1.2s var(--ease-out) 0.5s,
        opacity 0.8s var(--ease) 0.5s,
        z-index 0.01s linear 0.5s;
      pointer-events: none;
      filter: drop-shadow(0 20px 50px var(--shadow-heavy));
    }
    
    .letter {
      position: relative;
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom, var(--paper-color-1), var(--paper-color-2));
      border-radius: 10px;
      padding: 25px;
      overflow: hidden;
      border: 1px solid rgba(200, 180, 150, 0.5);
      box-shadow: 
        0 15px 40px var(--shadow-medium),
        inset 0 0 40px rgba(255, 255, 255, 0.6),
        inset 0 0 0 1px rgba(255, 255, 255, 0.3);
      transform-style: preserve-3d;
      display: flex;
      flex-direction: column;
    }
    
    /* Textura de papel con l铆neas */
    .letter::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        linear-gradient(90deg, transparent 97%, rgba(200, 170, 130, 0.1) 100%),
        linear-gradient(rgba(200, 170, 130, 0.08) 1px, transparent 1px);
      background-size: 100% 28px;
      opacity: 0.7;
      pointer-events: none;
      border-radius: 10px;
    }
    
    /* Bordes decorativos */
    .letter::after {
      content: '';
      position: absolute;
      top: 12px;
      left: 12px;
      right: 12px;
      bottom: 12px;
      border: 1px solid rgba(160, 130, 90, 0.15);
      border-radius: 6px;
      pointer-events: none;
      box-shadow: inset 0 0 15px rgba(255, 255, 255, 0.5);
    }
    
    /* =========================================================
       ANIMACIN DE DESDOBLADO (3 PANELES CON 3D)
    ========================================================= */
    .letter-folds {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      transform-style: preserve-3d;
    }
    
    .fold-panel {
      position: absolute;
      left: 0;
      right: 0;
      height: calc(100% / 3);
      background: var(--paper-color-1);
      transform-origin: top center;
      transform-style: preserve-3d;
      transition: transform 1s var(--ease-out);
      box-shadow: 
        inset 0 5px 10px rgba(0, 0, 0, 0.05),
        inset 0 -5px 10px rgba(0, 0, 0, 0.05);
      border-top: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .fold-panel:nth-child(1) {
      top: 0;
      z-index: 3;
      transition-delay: 0.7s;
      border-radius: 10px 10px 0 0;
    }
    
    .fold-panel:nth-child(2) {
      top: calc(100% / 3);
      z-index: 2;
      transition-delay: 0.5s;
    }
    
    .fold-panel:nth-child(3) {
      top: calc(2 * 100% / 3);
      z-index: 1;
      transition-delay: 0.3s;
      border-radius: 0 0 10px 10px;
    }
    
    /* L铆neas de doblez */
    .fold-line {
      position: absolute;
      left: 10%;
      right: 10%;
      height: 1px;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(160, 130, 90, 0.4) 20%,
        rgba(160, 130, 90, 0.6) 50%,
        rgba(160, 130, 90, 0.4) 80%,
        transparent
      );
    }
    
    .fold-line.top {
      top: calc(100% / 3);
    }
    
    .fold-line.bottom {
      top: calc(2 * 100% / 3);
    }
    
    /* =========================================================
       CONTENIDO DE LA CARTA - MEJORADO PARA LECTURA
    ========================================================= */
    .letter-content {
      position: relative;
      flex: 1;
      display: flex;
      flex-direction: column;
      opacity: 0;
      transform: translateY(30px);
      transition: 
        opacity 0.8s var(--ease) 1.2s,
        transform 0.8s var(--ease) 1.2s;
      overflow-y: auto;
      z-index: 4;
      color: var(--ink-color);
      padding-right: 5px; /* Espacio para scrollbar */
      -webkit-overflow-scrolling: touch;
    }
    
    /* Scrollbar personalizada */
    .letter-content::-webkit-scrollbar {
      width: 6px;
    }
    
    .letter-content::-webkit-scrollbar-track {
      background: rgba(200, 180, 150, 0.15);
      border-radius: 3px;
      margin: 5px 0;
    }
    
    .letter-content::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, rgba(160, 130, 90, 0.6), rgba(140, 110, 70, 0.8));
      border-radius: 3px;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    /* Para Firefox */
    .letter-content {
      scrollbar-width: thin;
      scrollbar-color: rgba(160, 130, 90, 0.6) rgba(200, 180, 150, 0.15);
    }
    
    .letter-header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(160, 130, 90, 0.2);
      flex-shrink: 0;
    }
    
    .letter-title {
      font-family: 'Georgia', serif;
      font-size: clamp(24px, 5vw, 32px);
      font-weight: bold;
      color: var(--ink-color);
      margin-bottom: 8px;
      letter-spacing: 0.5px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      line-height: 1.3;
    }
    
    .letter-subtitle {
      font-family: 'Georgia', serif;
      font-style: italic;
      font-size: clamp(14px, 3vw, 18px);
      color: rgba(100, 70, 40, 0.8);
    }
    
    .letter-body {
      flex: 1;
      font-size: clamp(16px, 4vw, 18px);
      line-height: 1.7;
      font-family: 'Georgia', serif;
      overflow-y: auto;
    }
    
    .letter-body p {
      margin-bottom: 20px;
      text-align: justify;
      text-indent: 1.5em;
      hyphens: auto;
    }
    
    .salutation {
      font-size: clamp(18px, 4vw, 20px);
      margin-bottom: 25px;
      font-weight: bold;
      text-indent: 0;
    }
    
    .letter-photo-container {
      margin: 20px 0;
      text-align: center;
      flex-shrink: 0;
    }
    
    .letter-photo-frame {
      display: inline-block;
      padding: 12px;
      background: linear-gradient(145deg, var(--paper-color-2), var(--paper-color-3));
      border-radius: 10px;
      box-shadow: 
        0 8px 20px var(--shadow-light),
        inset 0 0 0 1px rgba(255, 255, 255, 0.6),
        inset 0 0 15px rgba(255, 255, 255, 0.3);
      border: 1px solid rgba(180, 150, 110, 0.3);
      position: relative;
      overflow: hidden;
      max-width: 100%;
    }
    
    .letter-photo-frame::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 30%, rgba(255, 200, 200, 0.15), transparent 70%),
        radial-gradient(circle at 80% 70%, rgba(200, 220, 255, 0.1), transparent 70%);
      pointer-events: none;
    }
    
    .letter-photo {
      width: 100%;
      max-width: 300px;
      height: var(--photo-height);
      object-fit: cover;
      border-radius: 6px;
      display: block;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(160, 130, 90, 0.2);
    }
    
    .letter-signature {
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid rgba(160, 130, 90, 0.2);
      text-align: right;
      font-family: 'Georgia', serif;
      flex-shrink: 0;
    }
    
    .signature-name {
      font-size: clamp(18px, 4vw, 22px);
      font-weight: bold;
      color: var(--ink-color);
      margin-bottom: 5px;
      letter-spacing: 0.5px;
    }
    
    .signature-date {
      font-size: clamp(14px, 3vw, 16px);
      color: rgba(100, 70, 40, 0.8);
      font-style: italic;
    }
    
    /* Bot贸n para cerrar - SIEMPRE VISIBLE */
    .close-letter-btn {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(to bottom, var(--paper-color-2), var(--paper-color-3));
      border: 1px solid rgba(160, 130, 90, 0.6);
      color: var(--ink-color);
      padding: 12px 28px;
      border-radius: 50px;
      font-family: 'Georgia', serif;
      font-size: clamp(14px, 3vw, 16px);
      cursor: pointer;
      transition: all 0.3s var(--ease);
      box-shadow: 0 8px 25px var(--shadow-medium);
      z-index: 50;
      pointer-events: auto;
      opacity: 0;
      transform: translateX(-50%) translateY(20px);
      transition: 
        opacity 0.5s var(--ease) 1.5s,
        transform 0.5s var(--ease) 1.5s,
        box-shadow 0.3s var(--ease);
      white-space: nowrap;
      min-width: 140px;
      text-align: center;
    }
    
    .close-letter-btn:hover {
      transform: translateX(-50%) translateY(-3px);
      box-shadow: 0 12px 30px var(--shadow-medium);
      background: linear-gradient(to bottom, var(--paper-color-1), var(--paper-color-2));
    }
    
    .close-letter-btn:active {
      transform: translateX(-50%) translateY(0);
    }
    
    /* =========================================================
       INDICADOR
    ========================================================= */
    .hint {
      position: absolute;
      bottom: 80px;
      font-size: clamp(16px, 4vw, 20px);
      color: rgba(255, 255, 255, 0.85);
      text-align: center;
      font-family: 'Georgia', serif;
      transition: all 0.6s var(--ease);
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      z-index: 5;
      letter-spacing: 0.5px;
      padding: 0 20px;
      width: 100%;
      pointer-events: none;
    }
    
    .hint::after {
      content: '';
      display: block;
      margin-top: 10px;
      font-size: clamp(24px, 5vw, 28px);
      animation: bounce 2s infinite var(--ease-in-out);
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    /* =========================================================
       DECORACIONES EXTRAS (BODEGN)
    ========================================================= */
    .decoration {
      position: fixed;
      pointer-events: none;
      z-index: 3;
    }
    
    .flower {
      position: fixed;
      bottom: 22%;
      left: 10%;
      width: 60px;
      height: 60px;
      background: radial-gradient(circle at 30% 30%, #f8c8dc, #f4a6c8);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      transform: rotate(25deg);
      opacity: 0.7;
      filter: drop-shadow(0 8px 15px rgba(0, 0, 0, 0.25));
      animation: float 6s ease-in-out infinite;
    }
    
    .flower::before, .flower::after {
      content: '';
      position: absolute;
      background: radial-gradient(circle at 30% 30%, #f8c8dc, #f4a6c8);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    }
    
    .flower::before {
      width: 50px;
      height: 50px;
      top: -15px;
      left: 15px;
      transform: rotate(-45deg);
    }
    
    .flower::after {
      width: 45px;
      height: 45px;
      top: 5px;
      right: -10px;
      transform: rotate(45deg);
    }
    
    @keyframes float {
      0%, 100% { transform: rotate(25deg) translateY(0); }
      50% { transform: rotate(25deg) translateY(-10px); }
    }
    
    /* =========================================================
       ESTADO ABIERTO - ANIMACIONES MEJORADAS
    ========================================================= */
    .open .desk-light {
      opacity: 1;
    }
    
    /* Sobre se mueve hacia abajo y atr谩s */
    .open .envelope-wrapper {
      transform: translateY(60px) scale(0.9);
      z-index: 15; /* IMPORTANTE: ahora est谩 DETRS de la carta */
      transition: 
        transform 1s var(--ease-out) 0.3s,
        z-index 0.01s linear 0.3s;
      pointer-events: none;
    }
    
    /* Tapa se abre con efecto de "romper sello" */
    .open .envelope-flap {
      transform: rotateX(-180deg);
      transition: transform 1.2s var(--ease-out) 0.2s;
    }
    
    /* Sello se "rompe" y cae un poco */
    .open .wax-seal {
      transform: translate(-50%, -50%) scale(0.8) rotate(-15deg);
      opacity: 0.7;
      filter: blur(1.5px) brightness(0.9);
      box-shadow: 
        0 4px 15px rgba(0, 0, 0, 0.3),
        inset 0 1px 5px rgba(255, 255, 255, 0.2),
        inset 0 -1px 5px rgba(0, 0, 0, 0.3);
    }
    
    /* CARTA: Aparece CENTRADA en la pantalla */
    .open .letter-container {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
      z-index: 25; /* IMPORTANTE: ahora est谩 ENCIMA de todo */
      pointer-events: auto;
      transition: 
        transform 1.2s var(--ease-out) 0.5s,
        opacity 0.8s var(--ease) 0.5s,
        z-index 0.01s linear 0.5s;
    }
    
    /* Animaci贸n de desdoblado en acorde贸n */
    .open .fold-panel:nth-child(1) {
      transform: rotateX(0deg);
      transition-delay: 0.9s;
    }
    
    .open .fold-panel:nth-child(2) {
      transform: rotateX(0deg);
      transition-delay: 0.7s;
    }
    
    .open .fold-panel:nth-child(3) {
      transform: rotateX(0deg);
      transition-delay: 0.5s;
    }
    
    /* Contenido aparece despu茅s del desdoblado */
    .open .letter-content {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* Bot贸n aparece al final */
    .open .close-letter-btn {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    /* Indicador desaparece */
    .open .hint {
      opacity: 0;
      transform: translateY(30px);
      pointer-events: none;
    }
    
    /* Efecto de flotaci贸n sutil para la carta abierta */
    .open .letter-container {
      animation: gentleFloat 4s var(--ease-in-out) 1.5s infinite;
    }
    
    @keyframes gentleFloat {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, calc(-50% - 5px)) scale(1); }
    }
    
    /* =========================================================
       MEDIA QUERIES PARA DISPOSITIVOS MVILES
    ========================================================= */
    /* Tel茅fonos peque帽os (hasta 480px) */
    @media (max-width: 480px) {
      :root {
        --envelope-width: min(320px, 88vw);
        --paper-width: min(300px, 85vw);
        --paper-height: min(500px, 75vh);
        --photo-height: clamp(120px, 25vh, 180px);
      }
      
      .container {
        padding: 10px;
        padding-bottom: 80px;
        justify-content: flex-start;
        padding-top: 40px;
      }
      
      .envelope-wrapper {
        margin-top: 30px;
        margin-bottom: 20px;
      }
      
      .letter {
        padding: 20px 18px;
        border-radius: 8px;
      }
      
      .letter::after {
        top: 8px;
        left: 8px;
        right: 8px;
        bottom: 8px;
        border-radius: 4px;
      }
      
      .letter-content {
        padding-right: 3px;
      }
      
      .letter-body p {
        margin-bottom: 18px;
        text-indent: 1em;
        line-height: 1.6;
      }
      
      .letter-photo-frame {
        padding: 10px;
      }
      
      .letter-photo {
        max-width: 260px;
      }
      
      .close-letter-btn {
        padding: 10px 22px;
        font-size: 15px;
        bottom: 15px;
        min-width: 130px;
      }
      
      .hint {
        bottom: 60px;
        font-size: 17px;
      }
      
      .hint::after {
        font-size: 26px;
        margin-top: 8px;
      }
      
      .flower {
        width: 50px;
        height: 50px;
        left: 5%;
        bottom: 25%;
        opacity: 0.5;
      }
      
      .flower::before {
        width: 40px;
        height: 40px;
      }
      
      .flower::after {
        width: 35px;
        height: 35px;
      }
      
      .open .envelope-wrapper {
        transform: translateY(40px) scale(0.85);
      }
    }
    
    /* Tel茅fonos medianos (481px - 767px) */
    @media (min-width: 481px) and (max-width: 767px) {
      :root {
        --envelope-width: min(380px, 85vw);
        --paper-width: min(340px, 82vw);
        --paper-height: min(550px, 75vh);
      }
      
      .container {
        padding: 15px;
        padding-bottom: 90px;
      }
      
      .letter {
        padding: 22px 20px;
      }
      
      .close-letter-btn {
        padding: 11px 25px;
        font-size: 15px;
      }
      
      .hint {
        bottom: 70px;
      }
      
      .flower {
        left: 8%;
        bottom: 24%;
      }
    }
    
    /* Tablets y pantallas peque帽as (768px - 1024px) */
    @media (min-width: 768px) and (max-width: 1024px) {
      :root {
        --envelope-width: min(420px, 80vw);
        --paper-width: min(380px, 78vw);
        --paper-height: min(600px, 75vh);
      }
      
      .container {
        padding: 20px;
        padding-bottom: 100px;
      }
      
      .flower {
        left: 12%;
        bottom: 22%;
      }
    }
    
    /* Pantallas muy altas */
    @media (min-height: 1000px) {
      :root {
        --paper-height: min(700px, 65vh);
        --photo-height: clamp(150px, 15vh, 220px);
      }
      
      .container {
        padding-bottom: 120px;
      }
      
      .hint {
        bottom: 100px;
      }
    }
    
    /* Pantallas muy cortas */
    @media (max-height: 600px) {
      :root {
        --paper-height: min(450px, 75vh);
        --envelope-height: calc(var(--envelope-width) * 0.5);
        --photo-height: clamp(100px, 18vh, 150px);
      }
      
      .container {
        padding-bottom: 70px;
        justify-content: flex-start;
        padding-top: 30px;
      }
      
      .envelope-wrapper {
        margin-top: 20px;
        margin-bottom: 15px;
      }
      
      .letter {
        padding: 18px 16px;
      }
      
      .letter-body {
        font-size: 15px;
        line-height: 1.6;
      }
      
      .letter-body p {
        margin-bottom: 16px;
      }
      
      .close-letter-btn {
        padding: 8px 20px;
        font-size: 14px;
        bottom: 12px;
      }
      
      .hint {
        bottom: 50px;
        font-size: 16px;
      }
      
      .flower {
        display: none;
      }
      
      .open .envelope-wrapper {
        transform: translateY(30px) scale(0.85);
      }
    }
    
    /* Orientaci贸n horizontal en m贸viles */
    @media (max-height: 500px) and (orientation: landscape) {
      :root {
        --envelope-width: min(300px, 45vw);
        --paper-width: min(280px, 42vw);
        --paper-height: min(400px, 85vh);
        --photo-height: clamp(80px, 15vh, 120px);
      }
      
      .container {
        flex-direction: row;
        justify-content: center;
        align-items: center;
        gap: 30px;
        padding: 10px;
      }
      
      .envelope-wrapper {
        margin: 0;
      }
      
      .letter-container {
        position: relative;
        top: auto;
        left: auto;
        transform: none;
        margin: 0;
      }
      
      .open .letter-container {
        transform: none;
        animation: none;
      }
      
      .hint {
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: auto;
      }
      
      .open .hint {
        transform: translateX(-50%) translateY(30px);
      }
      
      @keyframes gentleFloat {
        0%, 100% { transform: none; }
        50% { transform: translateY(-5px); }
      }
    }
    
    /* Soporte para preferencia de movimiento reducido */
    @media (prefers-reduced-motion: reduce) {
      * {
        transition-duration: 0.01ms !important;
        animation-duration: 0.01ms !important;
      }
      
      body::before {
        animation: none;
      }
      
      .hint::after {
        animation: none;
      }
      
      .flower {
        animation: none;
      }
      
      .open .letter-container {
        animation: none;
      }
    }
    
    /* Modo oscuro del sistema */
    @media (prefers-color-scheme: dark) {
      :root {
        --ink-color: #f0e6d6;
        --paper-color-1: #1a1a1a;
        --paper-color-2: #222222;
        --paper-color-3: #2a2a2a;
        --envelope-color-1: #2a2a2a;
        --envelope-color-2: #333333;
        --envelope-color-3: #3a3a3a;
      }
      
      .letter {
        border-color: rgba(100, 80, 60, 0.4);
      }
      
      .letter::before {
        opacity: 0.4;
      }
    }
  </style>
</head>
<body>
  <!-- Mesa con luz -->
  <div class="desk"></div>
  <div class="desk-light"></div>
  
  <!-- Decoraciones -->
  <div class="decoration flower"></div>
  
  <div class="container">
    <!-- Indicador -->
    <div class="hint">Toca el sobre para abrir la carta</div>
    
    <!-- Sobre -->
    <div class="envelope-wrapper" id="envelope">
      <div class="envelope">
        <div class="envelope-side left"></div>
        <div class="envelope-side right"></div>
        <div class="envelope-bottom"></div>
        <div class="envelope-flap"></div>
        <div class="envelope-string"></div>
        
        <!-- Sello de cera con coraz贸n -->
        <div class="wax-seal">
          <div class="seal-border"></div>
        </div>
      </div>
    </div>
    
    <!-- Carta con animaci贸n de desdoblado -->
    <div class="letter-container" id="letterContainer">
      <div class="letter">
        <!-- Paneles de desdoblado 3D -->
        <div class="letter-folds">
          <div class="fold-panel"></div>
          <div class="fold-panel"></div>
          <div class="fold-panel"></div>
          <div class="fold-line top"></div>
          <div class="fold-line bottom"></div>
        </div>
        
        <!-- Contenido -->
        <div class="letter-content" id="letterContent">
          <div class="letter-header">
            <h1 class="letter-title">Para Ti, Con Todo Mi Cari帽o issa</h1>
            <div class="letter-subtitle">Una carta escrita desde el coraz贸n</div>
          </div>
          
          <div class="letter-body">
            <p class="salutation">Mi muy querida Sofia</p>
            
            <p>
              Aqui va escrito
            </p>
            
            <p>
              Aqui va escrito
            </p>
            
            <p>
              Aqui va escrito
            </p>
            
            <!-- Foto -->
            <div class="letter-photo-container">
              <div class="letter-photo-frame">
                <img class="letter-photo" src="Foto.jpg" alt="Un momento especial que atesoro">
              </div>
            </div>
            
            <p>
              Aquiva escrito
            </p>
            
            <p>
              Aqui va escrito
            </p>
            
            <p>
              aqui va escrito
            </p>
            
            <div class="letter-signature">
              <div class="signature-name">Con todo mi amor</div>
              <div class="signature-date">Siempre a tu lado</div>
            </div>
          </div>
        </div>
        
        <!-- Bot贸n para cerrar -->
        <button class="close-letter-btn" id="closeBtn">Cerrar carta</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      'use strict';
      
      // Elementos principales
      const envelope = document.getElementById('envelope');
      const letterContainer = document.getElementById('letterContainer');
      const letterContent = document.getElementById('letterContent');
      const closeBtn = document.getElementById('closeBtn');
      const hint = document.querySelector('.hint');
      const body = document.body;
      
      // Estado de la carta
      let isOpen = false;
      
      // Funci贸n para detectar dispositivo m贸vil
      function isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      }
      
      // Funci贸n para ajustar tama帽os en m贸viles
      function adjustForMobile() {
        if (isMobileDevice()) {
          // Ajustar altura m谩xima de la carta en m贸viles
          const viewportHeight = window.innerHeight;
          const maxPaperHeight = Math.min(580, viewportHeight * 0.75);
          
          document.documentElement.style.setProperty('--paper-height', `${maxPaperHeight}px`);
          
          // Ajustar posici贸n de la carta abierta
          const paperTop = -Math.min(180, viewportHeight * 0.25);
          document.documentElement.style.setProperty('--paper-top', `${paperTop}px`);
          
          console.log(`Ajustado para m贸vil: altura carta=${maxPaperHeight}px`);
        }
      }
      
      // Funci贸n para abrir la carta
      function openLetter() {
        if (isOpen) return;
        
        // A帽adir clase open al body
        body.classList.add('open');
        isOpen = true;
        
        // Bloquear scroll del body en m贸viles cuando la carta est谩 abierta
        if (isMobileDevice()) {
          document.body.style.overflow = 'hidden';
          document.documentElement.style.overflow = 'hidden';
        }
        
        // Actualizar atributos ARIA
        envelope.setAttribute('aria-label', 'Carta abierta');
        envelope.setAttribute('tabindex', '-1');
        letterContent.setAttribute('tabindex', '0');
        letterContent.setAttribute('aria-hidden', 'false');
        
        // Enfocar el contenido de la carta para accesibilidad
        setTimeout(() => {
          letterContent.focus();
          // Hacer scroll al principio del contenido
          letterContent.scrollTop = 0;
        }, 1600);
      }
      
      // Funci贸n para cerrar la carta
      function closeLetter() {
        if (!isOpen) return;
        
        // Remover clase open del body
        body.classList.remove('open');
        isOpen = false;
        
        // Restaurar scroll en m贸viles
        if (isMobileDevice()) {
          document.body.style.overflow = 'auto';
          document.documentElement.style.overflow = 'auto';
        }
        
        // Actualizar atributos ARIA
        envelope.setAttribute('aria-label', 'Carta cerrada - toca para abrir');
        envelope.setAttribute('tabindex', '0');
        letterContent.setAttribute('tabindex', '-1');
        letterContent.setAttribute('aria-hidden', 'true');
        
        // Enfocar el sobre para accesibilidad
        setTimeout(() => {
          envelope.focus();
        }, 500);
      }
      
      // Funci贸n para alternar estado
      function toggleLetter() {
        if (isOpen) {
          closeLetter();
        } else {
          openLetter();
        }
      }
      
      // Event Listeners
      
      // Abrir al hacer clic en el sobre
      envelope.addEventListener('click', function(e) {
        if (!isOpen) {
          openLetter();
        }
      });
      
      // Abrir con tecla Enter o Space en el sobre
      envelope.addEventListener('keydown', function(e) {
        if ((e.key === 'Enter' || e.key === ' ') && !isOpen) {
          e.preventDefault();
          openLetter();
        }
      });
      
      // Cerrar con bot贸n
      closeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        closeLetter();
      });
      
      // Cerrar con tecla Enter o Space en el bot贸n
      closeBtn.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          closeLetter();
        }
      });
      
      // Cerrar con tecla Escape
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && isOpen) {
          closeLetter();
        }
      });
      
      // Prevenir que el clic dentro de la carta cierre el sobre
      letterContainer.addEventListener('click', function(e) {
        e.stopPropagation();
      });
      
      // En m贸viles, prevenir gestos de zoom en la carta
      letterContent.addEventListener('touchstart', function(e) {
        if (e.touches.length > 1) {
          e.preventDefault();
        }
      }, { passive: false });
      
      // Inicializar atributos ARIA
      envelope.setAttribute('tabindex', '0');
      envelope.setAttribute('role', 'button');
      envelope.setAttribute('aria-label', 'Carta cerrada - toca para abrir');
      letterContent.setAttribute('tabindex', '-1');
      letterContent.setAttribute('aria-hidden', 'true');
      closeBtn.setAttribute('aria-label', 'Cerrar carta');
      
      // Manejo de imagen faltante
      const photo = document.querySelector('.letter-photo');
      photo.addEventListener('error', function() {
        this.alt = 'Imagen no disponible - Un recuerdo especial';
        this.style.backgroundColor = isMobileDevice() ? '#2a2a2a' : '#f0e2c9';
        this.style.display = 'flex';
        this.style.alignItems = 'center';
        this.style.justifyContent = 'center';
        this.style.color = isMobileDevice() ? '#d4b483' : '#8a5a2b';
        this.style.fontFamily = 'Georgia, serif';
        this.style.fontSize = isMobileDevice() ? '14px' : '16px';
        this.style.fontStyle = 'italic';
        this.style.padding = '20px';
        this.style.textAlign = 'center';
        this.style.lineHeight = '1.4';
        this.innerHTML = 'Este espacio guarda<br>un recuerdo especial<br>que llevo en mi coraz贸n';
      });
      
      // Efecto de hover en el sobre (solo en desktop)
      if (!isMobileDevice()) {
        envelope.addEventListener('mouseenter', function() {
          if (!isOpen) {
            this.style.transform = 'translateY(-5px) scale(1.02)';
          }
        });
        
        envelope.addEventListener('mouseleave', function() {
          if (!isOpen) {
            this.style.transform = 'translateY(0) scale(1)';
          }
        });
      }
      
      // Ajustar para m贸viles al cargar y al redimensionar
      adjustForMobile();
      window.addEventListener('resize', adjustForMobile);
      window.addEventListener('orientationchange', function() {
        setTimeout(adjustForMobile, 100);
      });
      
      // Inicializaci贸n
      console.log('Carta cargada correctamente');
      console.log('Dispositivo m贸vil:', isMobileDevice());
      
      // Verificar si hay una imagen
      fetch('Foto.jpg')
        .then(response => {
          if (!response.ok) {
            console.log('Foto.jpg no encontrada. Se mostrar谩 un mensaje alternativo.');
          }
        })
        .catch(() => {
          console.log('No se pudo cargar Foto.jpg. Se mostrar谩 un mensaje alternativo.');
        });
    })();
  </script>
</body>
</html>
